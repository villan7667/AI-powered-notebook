<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Notes Summarizer Pro</title>
    <link rel="icon" type="image/jpeg" href="{{ url_for('static', filename='assets/logo.jpeg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
   
</head>
<body data-theme="dark">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <span>AI Summarizer Pro</span>
            </a>
            <div class="nav-controls">
                <div class="nav-menu">
                    <a href="#" class="nav-link" onclick="showHistory()">
                        <i class="fas fa-history"></i> History
                    </a>
                    <a href="#" class="nav-link" onclick="showProfile()">
                        <i class="fas fa-user"></i> Profile
                    </a>
                </div>
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <span id="username">User</span>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Theme">
                    <i class="fas fa-moon" id="theme-icon"></i>
                </button>
                <a href="/logout" class="nav-link">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Main Content -->
        <div class="main-content">
            <h1><i class="fas fa-magic"></i> AI Notes Summarizer Pro</h1>
            
            <!-- Input Section -->
            <div class="input-section">
                <div class="textarea-container">
                    <textarea 
                        id="inputText" 
                        placeholder="Paste your notes, articles, research papers, or any text here for intelligent AI summarization. The more detailed your input, the better the summary will be..."
                        oninput="updateCharCount()"
                    ></textarea>
                    <div class="char-counter" id="charCounter">0 characters</div>
                </div>

                <!-- Voice Controls -->
                <div class="voice-controls">
                    <button class="voice-btn" id="recordBtn" onclick="toggleRecording()" title="Voice Input">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="voice-btn" onclick="clearText()" title="Clear Text" style="background: var(--warning-gradient);">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="voice-btn" onclick="pasteFromClipboard()" title="Paste from Clipboard" style="background: var(--purple-gradient);">
                        <i class="fas fa-paste"></i>
                    </button>
                </div>

                <!-- File Upload -->
                <div class="file-upload" onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" accept=".txt,.md" onchange="handleFileUpload(event)">
                    <div class="file-upload-content">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <div><strong>Drop your file here or click to browse</strong></div>
                        <small>Supports .txt and .md files up to 16MB</small>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls-row">
                    <div class="summary-type">
                        <button class="active" data-type="brief" onclick="setSummaryType('brief')">
                            <i class="fas fa-compress-alt"></i> Brief
                        </button>
                        <button data-type="balanced" onclick="setSummaryType('balanced')">
                            <i class="fas fa-balance-scale"></i> Balanced
                        </button>
                        <button data-type="detailed" onclick="setSummaryType('detailed')">
                            <i class="fas fa-expand-alt"></i> Detailed
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="summarizeText()" id="summarizeBtn">
                        <i class="fas fa-magic"></i> Generate Summary
                    </button>
                    <button class="btn btn-secondary" onclick="speakSummary()" id="speakBtn" disabled>
                        <i class="fas fa-volume-up"></i> Listen
                    </button>
                    <button class="btn btn-secondary" onclick="downloadSummary()" id="downloadBtn" disabled>
                        <i class="fas fa-download"></i> Download
                    </button>
                    <button class="btn btn-secondary" onclick="copyToClipboard()" id="copyBtn" disabled>
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button class="btn btn-secondary" onclick="shareResult()" id="shareBtn" disabled>
                        <i class="fas fa-share"></i> Share
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results" id="results"></div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Text Analysis Card -->
            <div class="sidebar-card">
                <h3><i class="fas fa-chart-bar"></i> Text Analysis</h3>
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <span class="stat-number" id="wordCount">0</span>
                        <span class="stat-label">Words</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="sentenceCount">0</span>
                        <span class="stat-label">Sentences</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="charCount">0</span>
                        <span class="stat-label">Characters</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="avgWords">0</span>
                        <span class="stat-label">Avg Words/Sentence</span>
                    </div>
                </div>
            </div>

            <!-- Keywords Card -->
            <div class="sidebar-card">
                <h3><i class="fas fa-tags"></i> Keywords</h3>
                <div class="keywords" id="keywords">
                    <span class="keyword-tag">No keywords yet</span>
                </div>
            </div>

            <!-- Summary Stats Card -->
            <div class="sidebar-card">
                <h3><i class="fas fa-info-circle"></i> Summary Stats</h3>
                <div class="stats-grid" id="summaryStats">
                    <div class="stat-card">
                        <span class="stat-number" id="compressionRatio">0%</span>
                        <span class="stat-label">Compression</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="summaryWords">0</span>
                        <span class="stat-label">Summary Words</span>
                    </div>
                </div>
            </div>

            <!-- Recent History Card -->
            <div class="sidebar-card">
                <h3><i class="fas fa-clock"></i> Recent History</h3>
                <div class="history-section" id="recentHistory">
                    <div class="history-item">
                        <div class="history-title">No recent summaries</div>
                        <div class="history-meta">
                            <span>Start summarizing to see history</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-history"></i> Summary History</h2>
                <button class="close-btn" onclick="closeModal('historyModal')">&times;</button>
            </div>
            <div id="historyContent">
                <div class="loading"></div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal" id="profileModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><i class="fas fa-user"></i> User Profile</h2>
                <button class="close-btn" onclick="closeModal('profileModal')">&times;</button>
            </div>
            <div id="profileContent">
                <div class="loading"></div>
            </div>
        </div>
    </div>

    <script>
        let currentSummary = '';
        let currentSummaryType = 'brief';
        let recognition = null;
        let isRecording = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initializeSpeechRecognition();
            loadTheme();
            loadUserInfo();
            loadRecentHistory();
        });

        // User Info
        function loadUserInfo() {
            // This would typically come from the server
            const username = '{{ session.username }}' || 'User';
            const userAvatar = document.getElementById('userAvatar');
            const usernameEl = document.getElementById('username');
            
            usernameEl.textContent = username;
            userAvatar.textContent = username.charAt(0).toUpperCase();
        }

        // Theme Management
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const icon = document.getElementById('theme-icon');
            icon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const icon = document.getElementById('theme-icon');
            icon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
        }

        // Speech Recognition
        function initializeSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';

                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }
                    if (finalTranscript) {
                        const textarea = document.getElementById('inputText');
                        textarea.value += finalTranscript + ' ';
                        updateCharCount();
                        updateStats();
                    }
                };

                recognition.onerror = function(event) {
                    console.error('Speech recognition error:', event.error);
                    showToast('Speech recognition error: ' + event.error, 'error');
                    stopRecording();
                };

                recognition.onend = function() {
                    stopRecording();
                };
            }
        }

        function toggleRecording() {
            if (!recognition) {
                showToast('Speech recognition not supported in this browser', 'error');
                return;
            }

            if (isRecording) {
                recognition.stop();
            } else {
                recognition.start();
                startRecording();
            }
        }

        function startRecording() {
            isRecording = true;
            const btn = document.getElementById('recordBtn');
            btn.classList.add('recording');
            btn.innerHTML = '<i class="fas fa-stop"></i>';
            showToast('Recording started... Speak now!', 'success');
        }

        function stopRecording() {
            isRecording = false;
            const btn = document.getElementById('recordBtn');
            btn.classList.remove('recording');
            btn.innerHTML = '<i class="fas fa-microphone"></i>';
        }

        // Text Management
        function updateCharCount() {
            const textarea = document.getElementById('inputText');
            const counter = document.getElementById('charCounter');
            const count = textarea.value.length;
            counter.textContent = `${count.toLocaleString()} characters`;
            
            updateStats();
        }

        function updateStats() {
            const text = document.getElementById('inputText').value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            const sentences = text.trim() ? text.split(/[.!?]+/).filter(s => s.trim()).length : 0;
            const chars = text.length;
            const avgWords = sentences > 0 ? Math.round(words / sentences * 10) / 10 : 0;

            document.getElementById('wordCount').textContent = words.toLocaleString();
            document.getElementById('sentenceCount').textContent = sentences.toLocaleString();
            document.getElementById('charCount').textContent = chars.toLocaleString();
            document.getElementById('avgWords').textContent = avgWords;
        }

        function clearText() {
            document.getElementById('inputText').value = '';
            updateCharCount();
            clearResults();
            showToast('Text cleared successfully', 'success');
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                if (text) {
                    document.getElementById('inputText').value = text;
                    updateCharCount();
                    showToast('Text pasted from clipboard', 'success');
                } else {
                    showToast('No text found in clipboard', 'error');
                }
            } catch (error) {
                showToast('Failed to access clipboard', 'error');
            }
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('keywords').innerHTML = '<span class="keyword-tag">No keywords yet</span>';
            document.getElementById('compressionRatio').textContent = '0%';
            document.getElementById('summaryWords').textContent = '0';
            
            const buttons = ['speakBtn', 'downloadBtn', 'copyBtn', 'shareBtn'];
            buttons.forEach(id => document.getElementById(id).disabled = true);
            
            currentSummary = '';
        }

        // File Upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            showToast('Uploading file...', 'success');

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, 'error');
                } else {
                    document.getElementById('inputText').value = data.content;
                    updateCharCount();
                    showToast(`File "${data.filename}" loaded successfully!`, 'success');
                }
            })
            .catch(error => {
                console.error('Upload error:', error);
                showToast('Error uploading file', 'error');
            });
        }

        // Summary Type
        function setSummaryType(type) {
            currentSummaryType = type;
            document.querySelectorAll('.summary-type button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-type="${type}"]`).classList.add('active');
        }

        // Summarization
        function summarizeText() {
            const text = document.getElementById('inputText').value.trim();
            
            if (!text) {
                showToast('Please enter some text to summarize', 'error');
                return;
            }

            if (text.length < 50) {
                showToast('Text is too short for meaningful summarization', 'error');
                return;
            }

            const btn = document.getElementById('summarizeBtn');
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Processing...';

            fetch('/summarize', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    text: text,
                    type: currentSummaryType
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    showToast(data.error, 'error');
                } else {
                    displayResults(data);
                    showToast('Summary generated successfully!', 'success');
                    loadRecentHistory(); // Refresh history
                }
            })
            .catch(error => {
                console.error('Summarization error:', error);
                showToast('Error generating summary', 'error');
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-magic"></i> Generate Summary';
            });
        }

        function displayResults(data) {
            currentSummary = data.summary;
            
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="summary-card">
                    <div class="summary-header">
                        <h3 class="summary-title">
                            <i class="fas fa-file-alt"></i> AI Generated Summary
                        </h3>
                        <div class="summary-actions">
                            <button class="action-btn" onclick="speakSummary()" title="Listen">
                                <i class="fas fa-volume-up"></i>
                            </button>
                            <button class="action-btn" onclick="copyToClipboard()" title="Copy">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="action-btn" onclick="downloadSummary()" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="action-btn" onclick="shareResult()" title="Share">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </div>
                    <div class="summary-content">${data.summary}</div>
                </div>
            `;

            // Update keywords
            const keywordsDiv = document.getElementById('keywords');
            if (data.keywords && data.keywords.length > 0) {
                keywordsDiv.innerHTML = data.keywords.map(keyword => 
                    `<span class="keyword-tag">${keyword}</span>`
                ).join('');
            }

            // Update summary stats
            document.getElementById('compressionRatio').textContent = `${data.compression_ratio}%`;
            document.getElementById('summaryWords').textContent = data.summary_stats.word_count.toLocaleString();

            // Enable action buttons
            const buttons = ['speakBtn', 'downloadBtn', 'copyBtn', 'shareBtn'];
            buttons.forEach(id => document.getElementById(id).disabled = false);
        }

        // Audio Functions
        function speakSummary() {
            if (!currentSummary) {
                showToast('No summary available to speak', 'error');
                return;
            }

            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(currentSummary);
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                utterance.onstart = () => showToast('Speaking...', 'success');
                utterance.onend = () => showToast('Finished speaking', 'success');
                utterance.onerror = () => showToast('Error in speech synthesis', 'error');
                
                window.speechSynthesis.speak(utterance);
            } else {
                showToast('Speech synthesis not supported', 'error');
            }
        }

        // Download Function
        function downloadSummary() {
            if (!currentSummary) {
                showToast('No summary available to download', 'error');
                return;
            }

            const blob = new Blob([currentSummary], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-summary-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Summary downloaded!', 'success');
        }

        // Copy Function
        function copyToClipboard() {
            if (!currentSummary) {
                showToast('No summary available to copy', 'error');
                return;
            }

            navigator.clipboard.writeText(currentSummary).then(() => {
                showToast('Summary copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Failed to copy to clipboard', 'error');
            });
        }

        // Share Function
        function shareResult() {
            if (!currentSummary) {
                showToast('No summary available to share', 'error');
                return;
            }

            if (navigator.share) {
                navigator.share({
                    title: 'AI Generated Summary',
                    text: currentSummary,
                    url: window.location.href
                }).then(() => {
                    showToast('Summary shared successfully!', 'success');
                }).catch(() => {
                    showToast('Error sharing summary', 'error');
                });
            } else {
                // Fallback to copying to clipboard
                copyToClipboard();
            }
        }

        // History Functions
        function loadRecentHistory() {
            fetch('/history')
            .then(response => response.json())
            .then(data => {
                if (data.summaries && data.summaries.length > 0) {
                    const historyDiv = document.getElementById('recentHistory');
                    historyDiv.innerHTML = data.summaries.slice(0, 3).map(summary => `
                        <div class="history-item" onclick="loadSummary('${summary._id}')">
                            <div class="history-title">${summary.title}</div>
                            <div class="history-meta">
                                <span>${new Date(summary.created_at).toLocaleDateString()}</span>
                                <span class="history-type">${summary.summary_type}</span>
                            </div>
                        </div>
                    `).join('');
                }
            })
            .catch(error => {
                console.error('Error loading history:', error);
            });
        }

        function showHistory() {
            const modal = document.getElementById('historyModal');
            const content = document.getElementById('historyContent');
            
            modal.classList.add('show');
            content.innerHTML = '<div class="loading"></div>';

            fetch('/history')
            .then(response => response.json())
            .then(data => {
                if (data.summaries && data.summaries.length > 0) {
                    content.innerHTML = data.summaries.map(summary => `
                        <div class="history-item">
                            <div class="history-title">${summary.title}</div>
                            <div class="history-meta">
                                <span>${new Date(summary.created_at).toLocaleString()}</span>
                                <span class="history-type">${summary.summary_type}</span>
                            </div>
                            <div style="margin-top: 1rem; padding: 1rem; background: var(--bg-glass); border-radius: 8px; font-size: 0.9rem; line-height: 1.6;">
                                ${summary.summary}
                            </div>
                            <div style="margin-top: 0.5rem; display: flex; gap: 0.5rem;">
                                <button class="action-btn" onclick="copyText('${summary.summary.replace(/'/g, "\\'")}')">
                                    <i class="fas fa-copy"></i>
                                </button>
                                <button class="action-btn" onclick="deleteSummary('${summary._id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');
                } else {
                    content.innerHTML = '<p style="text-align: center; color: var(--text-muted);">No summaries found</p>';
                }
            })
            .catch(error => {
                console.error('Error loading history:', error);
                content.innerHTML = '<p style="text-align: center; color: var(--text-muted);">Error loading history</p>';
            });
        }

        function showProfile() {
            const modal = document.getElementById('profileModal');
            const content = document.getElementById('profileContent');
            
            modal.classList.add('show');
            content.innerHTML = '<div class="loading"></div>';

            fetch('/profile')
            .then(response => response.json())
            .then(data => {
                content.innerHTML = `
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="width: 80px; height: 80px; background: var(--accent-gradient); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2rem; color: white; font-weight: 700;">
                            ${data.username.charAt(0).toUpperCase()}
                        </div>
                        <h3 style="color: var(--text-primary); margin-bottom: 0.5rem;">${data.username}</h3>
                        <p style="color: var(--text-muted);">${data.email}</p>
                    </div>
                    
                    <div class="stats-grid" style="margin-bottom: 2rem;">
                        <div class="stat-card">
                            <span class="stat-number">${data.total_summaries}</span>
                            <span class="stat-label">Total Summaries</span>
                        </div>
                        <div class="stat-card">
                            <span class="stat-number">${new Date(data.member_since).toLocaleDateString()}</span>
                            <span class="stat-label">Member Since</span>
                        </div>
                    </div>
                    
                    <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Recent Activity</h4>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${data.recent_activity.map(activity => `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                <span style="color: var(--text-secondary);">${new Date(activity.date).toLocaleDateString()}</span>
                                <span class="history-type">${activity.type}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            })
            .catch(error => {
                console.error('Error loading profile:', error);
                content.innerHTML = '<p style="text-align: center; color: var(--text-muted);">Error loading profile</p>';
            });
        }

        function deleteSummary(summaryId) {
            if (confirm('Are you sure you want to delete this summary?')) {
                fetch(`/delete_summary/${summaryId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Summary deleted successfully', 'success');
                        showHistory(); // Refresh history
                        loadRecentHistory(); // Refresh recent history
                    } else {
                        showToast(data.error || 'Error deleting summary', 'error');
                    }
                })
                .catch(error => {
                    console.error('Delete error:', error);
                    showToast('Error deleting summary', 'error');
                });
            }
        }

        function copyText(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('Text copied to clipboard!', 'success');
            }).catch(() => {
                showToast('Failed to copy text', 'error');
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Toast Notifications
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.add('show'), 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 400);
            }, 4000);
        }

        // Drag and Drop
        document.addEventListener('DOMContentLoaded', function() {
            const fileUpload = document.querySelector('.file-upload');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileUpload.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                fileUpload.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                fileUpload.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                fileUpload.style.borderColor = '#4facfe';
                fileUpload.style.background = 'rgba(79, 172, 254, 0.2)';
                fileUpload.style.transform = 'translateY(-5px)';
            }

            function unhighlight(e) {
                fileUpload.style.borderColor = 'var(--border-color)';
                fileUpload.style.background = 'var(--bg-glass)';
                fileUpload.style.transform = 'translateY(0)';
            }

            fileUpload.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    const event = { target: { files: files } };
                    handleFileUpload(event);
                }
            }
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl/Cmd + Enter to summarize
            if ((event.ctrlKey || event.metaKey) && event.key === 'Enter') {
                event.preventDefault();
                summarizeText();
            }
            
            // Ctrl/Cmd + K to clear text
            if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                event.preventDefault();
                clearText();
            }
            
            // Escape to close modals
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal.show').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        });
    </script>
</body>
</html>
